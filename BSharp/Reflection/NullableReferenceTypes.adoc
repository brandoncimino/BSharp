= Nullable Reference Types

:icons: font

See: https://stackoverflow.com/a/68757807/18494923

.Actual C# Code
[source,c#]
----
class Box<T, T2> where T2 : notnull {
    public string? Str_Q;
    public string Str;
    public string?[] Array;
    public T?[] T_Q_Array;
    public T[] T_Array;
    public T[]? T_Array_Q;
}
----

."Lowered" Code
[source,c#]
----
[System.Runtime.CompilerServices.NullableContext(1)]                // <.>
[System.Runtime.CompilerServices.Nullable(0)]                       // <.>
internal class Box<
    [System.Runtime.CompilerServices.Nullable(2)] T,                // <.> 
    T2                                                              
>
{
    // string?
    [System.Runtime.CompilerServices.Nullable(2)]
    public string Str_Q;

    // string
    public string Str;                                              // <.>

    // string?[]
    [System.Runtime.CompilerServices.Nullable(new byte[] { 1, 2 })] // <.>
    public string[] Array;

    // T?[]
    [System.Runtime.CompilerServices.Nullable(new byte[] { 1, 2 })]
    public T[] T_Q_Array;

    // T[]
    public T[] T_Array;

    // T[]?
    [System.Runtime.CompilerServices.Nullable(new byte[] { 2, 1 })] // <.>
    public T[] T_Array_Q;
}
----

<.> Sets the "default" nullability for the members in the class
<.> No clue what this one does
<.> The nullability of the generic type parameters is determined by their `where` clauses, but the actual `[Nullable]` attributes get applied to the parameters themselves
<.> Gets it's nullability from the class's `[NullableContext(1)]` attribute, so it doesn't need its own
<.> "link:https://devblogs.microsoft.com/dotnet/announcing-net-6-preview-7/#getting-nested-nullability-information[Collection]" types have multiple `NullableAttribute.NullableFlags[]` entries: `{ 1, 2 }`
- `1` refers to the array type itself
- `2` refers to the entries